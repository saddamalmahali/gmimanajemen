/*!
 * @package   yii2-detail-view
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2016
 * @version   1.7.4
 *
 * Client extension for the yii2-detail-view extension
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2016, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t,n;t=".kvDetailView",n={click:"click"+t,afterValidate:"afterValidate"+t};var i=function(t,n){var i=this;i.$element=e(t),e.each(n,function(e,t){i[e]=t}),i.init()};i.prototype={constructor:i,init:function(){var e=this;e.initElements(),e.listen()},alert:function(e,t){var n,i=this;return n=i.alertMessageSettings[e],t?(n=n||"alert alert-"+e,i.alertTemplate.replace("{content}",t).replace("{class}",n)):""},initAlert:function(){var t=this,i=t.$element.find(".kv-alert-container"),a=n.click;i.find(".alert .close").each(function(){var t=e(this);t.off(a).on(a,function(){setTimeout(function(){i.find(".alert").length||i.hide()},300)})})},destroy:function(){var e=this,t=n.click,i=n.afterValidate;e.$btnSave.off(t),e.$btnUpdate.off(t),e.$btnView.off(t),e.$btnDelete.off(t),e.$element.find(".kv-detail-view").closest("form").off(i),e.$element.find(".kv-alert-container .alert .close").off(t)},listen:function(){var t=this,i=t.$element.find(".kv-alert-container"),a=n.click,l=n.afterValidate,o=t.$element.find(".kv-detail-view");o.closest("form").off(l).on(l,function(e,t){void 0!==t&&o.removeClass("kv-detail-loading")}),t.$btnSave.off(a).on(a,function(){i.hide(),o.removeClass("kv-detail-loading").addClass("kv-detail-loading")}),t.$btnUpdate.off(a).on(a,function(){t.setMode("edit")}),t.$btnView.off(a).on(a,function(){t.setMode("view")}),t.$btnDelete.off(a).on(a,function(n){var a=e(this),l=t.deleteParams,d=t.deleteConfirm,s=t.deleteAjaxSettings||{};n.preventDefault(),(!d||confirm(d))&&(s=e.extend({type:"post",dataType:"json",data:l,url:a.attr("href"),beforeSend:function(){i.html("").hide(),o.removeClass("kv-detail-loading").addClass("kv-detail-loading")},success:function(n){n.success&&(o.hide(),t.$btnDelete.attr("disabled","disabled"),t.$btnUpdate.attr("disabled","disabled"),t.$btnView.attr("disabled","disabled"),t.$btnSave.attr("disabled","disabled")),e.each(n.messages,function(e,n){i.append(t.alert(e,n))}),i.hide().fadeIn("slow",function(){o.removeClass("kv-detail-loading"),t.initAlert()})},error:function(n,a,l){var d="";t.showErrorStack&&(d=n.responseText?e(n.responseText).text():"",d=d&&d.length?"<pre>"+e.trim(d).replace(/\n\s*\n/g,"\n").replace(/</g,"&lt;")+"</pre>":""),d=t.alert("kv-detail-error",l+d),o.removeClass("kv-detail-loading"),i.html(d).hide().fadeIn("slow"),t.initAlert()}},s),e.ajax(s))}),t.initAlert()},setMode:function(e){var t=this,n=t.fadeDelay;"edit"===e?(t.$attribs.fadeOut(n,function(){t.$formAttribs.fadeIn(n),t.$element.removeClass("kv-view-mode kv-edit-mode").addClass("kv-edit-mode")}),t.$buttons1.fadeOut(n,function(){t.$buttons2.fadeIn(n)})):(t.$formAttribs.fadeOut(n,function(){t.$attribs.fadeIn(n),t.$element.removeClass("kv-view-mode kv-edit-mode").addClass("kv-view-mode")}),t.$buttons2.fadeOut(n,function(){t.$buttons1.fadeIn(n)}))},initElements:function(){var e=this,t=e.$element;e.$btnUpdate=t.find(".kv-btn-update"),e.$btnDelete=t.find(".kv-btn-delete"),e.$btnView=t.find(".kv-btn-view"),e.$btnSave=t.find(".kv-btn-save"),e.$attribs=t.find(".kv-attribute"),e.$formAttribs=t.find(".kv-form-attribute"),e.$buttons1=t.find(".kv-buttons-1"),e.$buttons2=t.find(".kv-buttons-2")}},e.fn.kvDetailView=function(t){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var a=e(this),l=a.data("kvDetailView"),o="object"==typeof t&&t;l||(l=new i(this,e.extend({},e.fn.kvDetailView.defaults,o,e(this).data())),a.data("kvDetailView",l)),"string"==typeof t&&l[t].apply(l,n)})},e.fn.kvDetailView.defaults={mode:"view",fadeDelay:800,alertTemplate:"",alertMessageSettings:{},deleteParams:{},deleteAjaxSettings:{},deleteConfirm:"",showErrorStack:!1},e.fn.kvDetailView.Constructor=i}(window.jQuery);